<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${pageTitle ?: 'Unified Order System'}">Unified Order System</title>

  <!-- CSS Files -->
  <link rel="stylesheet" th:href="@{/css/main.css}">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">

  <!-- Meta tags -->
  <meta name="description" th:content="${pageDescription ?: 'Modern order management system with real-time analytics'}">
  <meta name="keywords" content="order management, dashboard, analytics, real-time">
  <meta name="author" content="Unified Order System">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" th:content="${pageTitle ?: 'Unified Order System'}">
  <meta property="og:description" th:content="${pageDescription ?: 'Modern order management system'}">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" th:content="${pageTitle ?: 'Unified Order System'}">
  <meta property="twitter:description" th:content="${pageDescription ?: 'Modern order management system'}">

  <!-- Preload critical resources -->
  <link rel="preload" th:href="@{/css/main.css}" as="style">
  <link rel="preload" th:href="@{/js/app.js}" as="script">

  <!-- Additional head content -->
  <th:block th:fragment="head-extra"></th:block>
</head>

<body class="bg-secondary" th:classappend="${bodyClass ?: ''}">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-white p-2 rounded">
    Skip to main content
  </a>

  <!-- Main Application Layout -->
  <div class="app-layout">
    <!-- Sidebar Navigation -->
    <aside class="app-sidebar" id="sidebar" th:fragment="sidebar">
      <div class="sidebar-header">
        <h2 class="text-2xl font-bold text-primary mb-2">
          <a th:href="@{/dashboard}" class="text-decoration-none">Order System</a>
        </h2>
        <p class="text-sm text-secondary">v2.0.0</p>
      </div>

      <nav class="sidebar-nav" role="navigation" aria-label="Main navigation">
        <a th:href="@{/dashboard}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/dashboard') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">📊</span>
          Dashboard
        </a>

        <a th:href="@{/orders}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/orders') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">📦</span>
          Orders
          <span class="badge badge-primary ml-auto" th:if="${pendingOrdersCount > 0}"
            th:text="${pendingOrdersCount}">0</span>
        </a>

        <a th:href="@{/payments}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/payments') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">💳</span>
          Payments
        </a>

        <a th:href="@{/inventory}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/inventory') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">📋</span>
          Inventory
        </a>

        <a th:href="@{/customers}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/customers') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">👥</span>
          Customers
        </a>

        <a th:href="@{/analytics}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/analytics') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">📈</span>
          Analytics
        </a>

        <a th:href="@{/settings}" class="sidebar-nav-item"
          th:classappend="${#strings.contains(#httpServletRequest.requestURI, '/settings') ? 'active' : ''}">
          <span class="sidebar-nav-icon" aria-hidden="true">⚙️</span>
          Settings
        </a>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="app-main">
      <!-- Header -->
      <header class="app-header" th:fragment="header">
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-4">
            <button class="btn btn-secondary btn-sm md:hidden" onclick="toggleSidebar()"
              aria-label="Toggle navigation menu">
              ☰
            </button>
            <div>
              <h1 class="text-2xl font-semibold text-secondary-900" th:text="${pageTitle ?: 'Dashboard'}">Dashboard</h1>
              <p class="text-secondary-600" th:text="${pageSubtitle ?: 'Welcome back!'}">Welcome back!</p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <!-- Search (if enabled) -->
            <div class="relative hidden lg:block" th:if="${showSearch}">
              <input type="search" placeholder="Search..." class="form-input w-64 pl-10" aria-label="Search">
              <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-secondary-400">🔍</span>
            </div>

            <!-- Notifications -->
            <div class="relative">
              <button class="btn btn-secondary btn-sm relative" aria-label="Notifications" title="View notifications">
                🔔
                <span
                  class="absolute -top-1 -right-1 w-3 h-3 bg-error rounded-full text-xs text-white flex items-center justify-center"
                  th:if="${notificationCount > 0}" th:text="${notificationCount}"
                  aria-label="Unread notifications">3</span>
              </button>
            </div>

            <!-- User Menu -->
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white font-semibold"
                title="User profile">
                <span th:text="${#strings.substring(currentUser?.name ?: 'Admin', 0, 1)}">A</span>
              </div>
              <span class="text-sm font-medium text-secondary-700 hidden sm:block"
                th:text="${currentUser?.name ?: 'Admin User'}">Admin User</span>
            </div>

            <!-- Refresh Button -->
            <button class="btn btn-secondary btn-sm" onclick="refreshPage()" title="Refresh data"
              aria-label="Refresh page data">
              🔄
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <div class="app-content" id="main-content" role="main">
        <!-- Page content will be inserted here -->
        <th:block th:fragment="content">
          <div class="text-center py-12">
            <h2 class="text-xl font-semibold text-secondary-700 mb-2">Content Area</h2>
            <p class="text-secondary-500">Page content will be displayed here</p>
          </div>
        </th:block>
      </div>
    </main>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    role="dialog" aria-label="Loading" aria-hidden="true">
    <div class="bg-white rounded-lg p-6 flex items-center gap-3">
      <div class="loading-spinner" aria-hidden="true"></div>
      <span>Loading...</span>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container" role="region" aria-label="Notifications" aria-live="polite"></div>

  <!-- Confirmation Modal Template -->
  <div id="confirmationModal" class="modal-backdrop hidden" role="dialog" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Action</h3>
        <button class="modal-close" onclick="closeConfirmationModal()" aria-label="Close modal">×</button>
      </div>
      <div class="modal-body">
        <p id="confirmationMessage">Are you sure you want to proceed?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeConfirmationModal()">Cancel</button>
        <button class="btn btn-primary" id="confirmationButton">Confirm</button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script th:src="@{/js/app.js}"></script>

  <!-- Page-specific JavaScript -->
  <th:block th:fragment="scripts"></th:block>

  <!-- Global JavaScript initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize global app functionality
      initializeApp();

      // Initialize page-specific functionality
      if (typeof initializePage === 'function') {
        initializePage();
      }
    });

    // Global error handler
    window.addEventListener('error', function (e) {
      console.error('Global error:', e.error);
      showToast('An unexpected error occurred', 'error');
    });

    // Handle unhandled promise rejections
    window.addEventListener('unhandledrejection', function (e) {
      console.error('Unhandled promise rejection:', e.reason);
      showToast('An error occurred while processing your request', 'error');
    });
  </script>
</body>

</html>